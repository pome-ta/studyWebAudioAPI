<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <link rel="stylesheet" href="./styles/layout.css">

  <script src="https://cdn.jsdelivr.net/npm/eruda@2.4.1/eruda.min.js"></script>
  <script>eruda.init();</script>

  <!--<script type="module" src="./scripts/main.js"></script>-->
  <!-- <script src="./scripts/main.js"></script> -->

  <title>Web Audio API</title>
</head>
<h1>ほげ</h1>
<body>

  <div id="keyboard"></div>

</body>
<script src="https://cdn.jsdelivr.net/npm/qwerty-hancock@0.10.0/dist/qwerty-hancock.min.js"></script>

<script>
  window.AudioContext = window.AudioContext || window.webkitAudioContext;

  var context = new AudioContext(),
      settings = {
          id: 'keyboard',
          width: 600,
          height: 150,
          startNote: 'A2',
          margin: 'auto',
          whiteNotesColour: '#fff',
          blackNotesColour: '#000',
          borderColour: '#000',
          activeColour: 'yellow',
          octaves: 2,
          musicalTyping: false
      },
      keyboard = new QwertyHancock(settings);

  masterGain = context.createGain();
  nodes = [];

  masterGain.gain.value = 0.3;
  masterGain.connect(context.destination);

  keyboard.keyDown = function (note, frequency) {
      var oscillator = context.createOscillator();
      oscillator.type = 'square';
      oscillator.frequency.value = frequency;
      oscillator.connect(masterGain);
      oscillator.start(0);

      nodes.push(oscillator);
  };

  keyboard.keyUp = function (note, frequency) {
      const newNodes = [];

      for (var i = 0; i < nodes.length; i++) {
          if (Math.round(nodes[i].frequency.value) === Math.round(frequency)) {
              nodes[i].stop(0);
              nodes[i].disconnect();
          } else {
              newNodes.push(nodes[i]);
          }
      }

      nodes = newNodes;
  };

  keyboard = new QwertyHancock(settings);

  // Analytics

</script>
</html>
